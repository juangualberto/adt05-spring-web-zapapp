<!DOCTYPE html>
<html lang="es">

<head>
    <title>Zapatería Online: Añadir un usuario</title>
    <th:block th:replace="~{fragmentos/general.html :: headerfiles}"></th:block>
</head>

<body>

    <div th:replace="~{fragmentos/general.html :: navigation}"> </div>

    <div class="container">
        <h3>Editar usuario:</h3>

        <form th:action="|/admin/usuarios/add|" th:object="${usuario}" method="post">
            <input hidden th:field="${usuario.id}" />
            <div class="border">
                <div class="row g-3 m-2">
                    <div class="col-md-6">
                        <label class="form-label">Nombre: </label>
                        <input type="text" th:field="*{nombre}" class="form-control" />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Apellido: </label>
                        <input type="text" th:field="*{apellido}" class="form-control" />
                    </div>
                </div>
            </div>
            <div class="border">
                <label class="form-label">Direcciones:</label>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <th>Tipo Via</th>
                            <th>Nombre Via</th>
                            <th>Número Via</th>
                            <th>Planta</th>
                        </thead>
                        <tbody>
                            <!-- <tr th:if="${#lists.isEmpty(direcciones)}">
                                <td colspan="4"> Sin direcciones aún. </td>
                            </tr> -->
                            <tr th:each="direccion, itemDir : *{direcciones}">
                                <td>
                                    <input th:field="*{direcciones[__${itemDir.index}__].id}" type="hidden" />
                                    <input th:field="*{direcciones[__${itemDir.index}__].codigoPostal.municipio}" type="hidden" />
                                    <input class="form-control"
                                        th:field="*{direcciones[__${itemDir.index}__].tipoVia}" />
                                </td>
                                <td><input class="form-control"
                                        th:field="*{direcciones[__${itemDir.index}__].nombreVia}" /></td>
                                <td><input class="form-control"
                                        th:field="*{direcciones[__${itemDir.index}__].numero}" /></td>
                                <td><input class="form-control"
                                        th:field="*{direcciones[__${itemDir.index}__].planta}" /></td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="row-md-6 pt-2 m-2">
                        <div class="col">
                            <a href="#" class="btn btn-success p-2">Añadir dirección</a>
                            <a href="#" class="btn btn-warning p-2">Gestión direcciónes</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="border">
                <div class="row g-3 m-2">
                    <div class="col-md-4">
                        <label class="form-label">Nombre de usuario: </label>
                        <input type="text" th:field="*{username}" class="form-control" />
                    </div>
                    <div class="col-md-4">
                        <label class="form-label" for="email">Email:</label>
                        <input type="email" name="email" th:field="*{email}" class="form-control" />
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Contraseña:</label>
                        <input type="password" th:field="*{password}" class="form-control" />
                    </div>
                </div>
            </div>
            <div class="border">
                <div class="row g-3 m-2">

                    <div class="col-md-8">
                        <label class="form-label">Teléfonos:</label>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Código País</th>
                                    <th>Número de Teléfono</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="telefono, itemTelefono : *{telefonos}">
                                    <td>
                                        <input th:field="*{telefonos[__${itemTelefono.index}__].id}" type="hidden" />
                                        <input class="form-control col" type="number" min="1" max="2000"
                                            th:field="*{telefonos[__${itemTelefono.index}__].codigoPais}" />
                                    </td>
                                    <td>
                                        <input class="form-control col" type="number" min="1" max="999999999"
                                        th:field="*{telefonos[__${itemTelefono.index}__].numero}" />
                                    </td>
                                </tr>

                            </tbody>
                        </table>
                        
                        <div class="row-md-6 pt-2">
                            <div class="col">
                                <a th:href="|/admin/usuarios/${usuario.id}/telefonos/add|" class="btn btn-success p-2">Añadir teléfono</a>
                                <a th:href="|/admin/usuarios/${usuario.id}/telefonos|" class="btn btn-warning p-2">Gestión teléfonos</a>
                            </div>
                        </div>

                    </div>
                    <div class="col-md-4">                        
                        <label class="form-label">Roles:</label>
                        <!--<select th:field="*{roles}" multiple="multiple" class="form-select">
                             <option th:each="rol : ${listaRoles}" th:value="${rol.id}"
                                th:selected="${#lists.contains(usuario.roles, rol)} ? 'selected' : 'false'"
                                th:text="${rol.nombre}">
                            </option> 
                            <option th:each="rol,estado : ${roles}" th:value="${estado.index}" th:text="${rol}"></option>
                        </select>-->
                        <select th:field="*{roles}" multiple="multiple" class="form-select">
                            <option th:each="rol,estado : ${listaRoles}" th:value="${estado.index}" th:text="${rol}"></option>
                        </select>                        
                    </div> 
                </div>
            </div>
            <div class="border">
                <div class="row g-3 m-2">
                    <div class="col-md-6">
                        <button type="submit" class="btn btn-primary">Actualizar usuario</button>
                        <a href="/admin/usuarios" class="btn btn-danger">Cancelar cambios</a>
                    </div>
                </div>
        </form>

        <div th:replace="~{fragmentos/general.html :: footer}"></div>

    </div>
</body>

</html>